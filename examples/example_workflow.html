<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="goes_ortho.get_data" href="../get_data.html" /><link rel="prev" title="Download GOES" href="download.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Example workflow - goes_ortho 0.2.1.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">goes_ortho 0.2.1.5 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">goes_ortho 0.2.1.5 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download GOES</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Example workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_data.html">goes_ortho.get_data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orthorectify.html">goes_ortho.orthorectify</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseries.html">goes_ortho.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometry.html">goes_ortho.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clip.html">goes_ortho.clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rad.html">goes_ortho.rad</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="Example-workflow">
<h1>Example workflow<a class="headerlink" href="#Example-workflow" title="Permalink to this heading">#</a></h1>
<p>This notebook demonstrates downloading a short time series of GOES-R ABI imagery, merging the individual images into a single zarr dataset, and orthorectifying those images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">goes_ortho</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">geogif</span>
<span class="kn">import</span> <span class="nn">shutil</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/goes2go/data.py:665: FutureWarning: &#39;H&#39; is deprecated and will be removed in a future version. Please use &#39;h&#39; instead of &#39;H&#39;.
  within=pd.to_timedelta(config[&#34;nearesttime&#34;].get(&#34;within&#34;, &#34;1h&#34;)),
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/goes2go/NEW.py:188: FutureWarning: &#39;H&#39; is deprecated and will be removed in a future version. Please use &#39;h&#39; instead of &#39;H&#39;.
  within=pd.to_timedelta(config[&#34;nearesttime&#34;].get(&#34;within&#34;, &#34;1h&#34;)),
</pre></div></div>
</div>
<p>First, specify the time range, location bounds, satellite, product (and if applicable, band and variable) that weâ€™d like to access.</p>
<p>We will also need to provide an API key for <a class="reference external" href="https://portal.opentopography.org/requestService?service=api">OpenTopography.org</a> which you can create with a free account. This allows goes_ortho to access digital elevation models to perform the orthorectification step.</p>
<p>The workflow below was developed to read a json file containing information about what weâ€™d like to download. This was done to 1) allow these functions to run through github actions (still an experimental feature) and 2) keep a record of datasets weâ€™ve downloaded. This is something that may change in the near future since it adds an unnecessary step for most use cases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make request file from user input</span>
<span class="n">request_filepath</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">get_data</span><span class="o">.</span><span class="n">make_request_json</span><span class="p">(</span><span class="n">workflowName</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
                                                 <span class="n">startDatetime</span> <span class="o">=</span> <span class="s2">&quot;2024-09-19T00:00:00Z&quot;</span><span class="p">,</span>
                                                 <span class="n">endDatetime</span> <span class="o">=</span> <span class="s2">&quot;2024-09-20T00:59:00Z&quot;</span><span class="p">,</span>
                                                 <span class="n">bounds</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">get_data</span><span class="o">.</span><span class="n">bounds_from_geojson</span><span class="p">(</span><span class="s2">&quot;grand_mesa.geojson&quot;</span><span class="p">),</span>
                                                 <span class="n">satellite</span> <span class="o">=</span> <span class="s2">&quot;goes18&quot;</span><span class="p">,</span>
                                                 <span class="n">product</span> <span class="o">=</span> <span class="s2">&quot;ABI-L2-LSTC&quot;</span><span class="p">,</span>
                                                 <span class="n">band</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                                                 <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;LST&quot;</span><span class="p">,</span>
                                                 <span class="n">apiKey</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                                <span class="p">)</span>
</pre></div>
</div>
</div>
<p>The functions below demonstrate downloading GOES imagery using two different downloader packages: <a class="reference external" href="https://goes2go.readthedocs.io/en/latest/">goes2go</a> and <a class="reference external" href="https://github.com/spestana/goes-py">goespy</a> (the goespy functions are now integrated directly within the goes-ortho package). I have found goes2go is typically faster.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">filepaths</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">get_data</span><span class="o">.</span><span class="n">download_abi_goes2go</span><span class="p">(</span><span class="n">request_filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Estimated 9 batches to download
Batch number 1
Download batch of imagery from 2024-09-19 00:00:00+00:00 to 2024-09-19 03:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:01&lt;00:00,  1.81it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 2
Download batch of imagery from 2024-09-19 03:00:00+00:00 to 2024-09-19 06:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.92it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 3
Download batch of imagery from 2024-09-19 06:00:00+00:00 to 2024-09-19 09:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.86it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 4
Download batch of imagery from 2024-09-19 09:00:00+00:00 to 2024-09-19 12:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.92it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 5
Download batch of imagery from 2024-09-19 12:00:00+00:00 to 2024-09-19 15:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.88it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 6
Download batch of imagery from 2024-09-19 15:00:00+00:00 to 2024-09-19 18:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.85it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 7
Download batch of imagery from 2024-09-19 18:00:00+00:00 to 2024-09-19 21:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.78it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 8
Download batch of imagery from 2024-09-19 21:00:00+00:00 to 2024-09-20 00:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.78it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Batch number 9
Download batch of imagery from 2024-09-20 00:00:00+00:00 to 2024-09-20 03:00:00+00:00
ðŸ“¦ Finished downloading [3] files to [/home/spestana/data/noaa-goes18/ABI-L2-LSTC].
Cropping image batch to [-108.368202, 38.80429, -107.627676, 39.211234]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 3/3 [00:00&lt;00:00,  6.78it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Done
CPU times: user 5.34 s, sys: 465 ms, total: 5.8 s
Wall time: 13.5 s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>

</pre></div></div>
</div>
<p>Merge all the individual NetCDFs that we just downloaded into a single zarr file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zarr_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;my_file.zarr&quot;</span>
<span class="c1"># remove if file already exists</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">zarr_filepath</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">zarr_filepath</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">get_data</span><span class="o">.</span><span class="n">multi_nc_to_zarr</span><span class="p">(</span><span class="n">filepaths</span><span class="p">,</span> <span class="n">zarr_filepath</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Dask dashboard at: http://127.0.0.1:8786/status
Workers: 6
Threads per worker: 2

read all the netcdf files, drop attributes where there are conflicts
configure chunking on variables with dimensions of (time, x, y)
Assign the dimensions of a chunk to variables to use for encoding afterwards
Assign the dimensions of a chunk to variables to use for encoding afterwards
Assign the dimensions of a chunk to variables to use for encoding afterwards
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/spestana/git/goes-ortho/src/goes_ortho/get_data.py:691: UserWarning: Times can&#39;t be serialized faithfully to int64 with requested units &#39;days since 2024-09-19T00:01:17&#39;. Serializing with units &#39;hours since 2024-09-19T00:01:17&#39; instead. Set encoding[&#39;dtype&#39;] to floating point dtype to serialize with units &#39;days since 2024-09-19T00:01:17&#39;. Set encoding[&#39;units&#39;] to &#39;hours since 2024-09-19T00:01:17&#39; to silence this warning .
  ds.to_zarr(zarr_filepath)
</pre></div></div>
</div>
<p>Orthorectify the imagery in the zarr file</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bounds</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">get_data</span><span class="o">.</span><span class="n">bounds_from_geojson</span><span class="p">(</span><span class="s2">&quot;grand_mesa.geojson&quot;</span><span class="p">)</span>

<span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;585b1d1639bc5ef8a4a5bdea7e45a8d1&quot;</span>
<span class="n">out_filename</span> <span class="o">=</span> <span class="s1">&#39;test_ortho7.zarr&#39;</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">out_filename</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">go</span><span class="o">.</span><span class="n">orthorectify</span><span class="o">.</span><span class="n">ortho_zarr</span><span class="p">(</span>
    <span class="n">zarr_filepath</span><span class="p">,</span>
    <span class="p">[</span><span class="s1">&#39;LST&#39;</span><span class="p">],</span>
    <span class="n">bounds</span><span class="p">,</span>
    <span class="n">api_key</span><span class="p">,</span>
    <span class="n">out_filename</span><span class="p">,</span>
    <span class="n">dem_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">demtype</span><span class="o">=</span><span class="s2">&quot;SRTMGL3&quot;</span><span class="p">,</span>
    <span class="n">keep_dem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
https://portal.opentopography.org/API/globaldem?demtype=SRTMGL3&amp;west=-108.368202&amp;south=38.80429&amp;east=-107.627676&amp;north=39.211234&amp;outputFormat=GTiff&amp;API_Key=585b1d1639bc5ef8a4a5bdea7e45a8d1
/bin/gdalwarp -r cubic -co COMPRESS=LZW -co TILED=YES -co BIGTIFF=IF_SAFER -tr 30 30 -t_srs &#39;+proj=lonlat +datum=GRS80&#39; temp_SRTMGL3_DEM.tif temp_SRTMGL3_DEM_proj.tif
/bin/gdalwarp -r cubic -co COMPRESS=LZW -co TILED=YES -co BIGTIFF=IF_SAFER -tr 30 30 -t_srs &#39;+proj=lonlat +datum=GRS80&#39; temp_SRTMGL3_DEM.tif temp_SRTMGL3_DEM_proj.tif
Usage: gdalwarp [--help-general] [--formats]
    [-s_srs srs_def] [-t_srs srs_def] [-to &#34;NAME=VALUE&#34;]* [-novshiftgrid]
    [-order n | -tps | -rpc | -geoloc] [-et err_threshold]
    [-refine_gcps tolerance [minimum_gcps]]
    [-te xmin ymin xmax ymax] [-tr xres yres] [-tap] [-ts width height]
    [-ovr level|AUTO|AUTO-n|NONE] [-wo &#34;NAME=VALUE&#34;] [-ot Byte/Int16/...] [-wt Byte/Int16]
    [-srcnodata &#34;value [value...]&#34;] [-dstnodata &#34;value [value...]&#34;] -dstalpha
    [-r resampling_method] [-wm memory_in_mb] [-multi] [-q]
    [-cutline datasource] [-cl layer] [-cwhere expression]
    [-csql statement] [-cblend dist_in_pixels] [-crop_to_cutline]
    [-if format]* [-of format] [-co &#34;NAME=VALUE&#34;]* [-overwrite]
    [-nomd] [-cvmd meta_conflict_value] [-setci] [-oo NAME=VALUE]*
    [-doo NAME=VALUE]*
    srcfile* dstfile

Available resampling methods:
    near (default), bilinear, cubic, cubicspline, lanczos, average, rms,
    mode,  max, min, med, Q1, Q3, sum.

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -137.0          -137.0
...done

Map (orthorectify) and clip the image to the pixel map for LST
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
ERROR 1: PROJ: proj_create: Error -9 (unknown elliptical parameter name)
ERROR 1: Translating source or target SRS failed:
+proj=lonlat +datum=GRS80
Child returned 1
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/xarray/backends/plugins.py:149: RuntimeWarning: &#39;netcdf4&#39; fails while guessing
  warnings.warn(f&#34;{engine!r} fails while guessing&#34;, RuntimeWarning)
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/xarray/backends/plugins.py:149: RuntimeWarning: &#39;h5netcdf&#39; fails while guessing
  warnings.warn(f&#34;{engine!r} fails while guessing&#34;, RuntimeWarning)
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/xarray/backends/plugins.py:149: RuntimeWarning: &#39;scipy&#39; fails while guessing
  warnings.warn(f&#34;{engine!r} fails while guessing&#34;, RuntimeWarning)
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/xarray/backends/plugins.py:149: RuntimeWarning: &#39;netcdf4&#39; fails while guessing
  warnings.warn(f&#34;{engine!r} fails while guessing&#34;, RuntimeWarning)
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/xarray/backends/plugins.py:149: RuntimeWarning: &#39;h5netcdf&#39; fails while guessing
  warnings.warn(f&#34;{engine!r} fails while guessing&#34;, RuntimeWarning)
/home/spestana/.conda/envs/goes-test-env/lib/python3.12/site-packages/xarray/backends/plugins.py:149: RuntimeWarning: &#39;scipy&#39; fails while guessing
  warnings.warn(f&#34;{engine!r} fails while guessing&#34;, RuntimeWarning)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
...done
(27, 488, 889)

Map (orthorectify) and clip the image to the pixel map for ABI Fixed Grid coordinates
...done

Create zone labels for each unique pair of ABI Fixed Grid coordinates (for each orthorectified pixel footprint)
(488, 889)
...done

Output this result to a new zarr file
Saving file as: test_ortho7.zarr
...done
</pre></div></div>
</div>
<p>Open the orthorectified imagery file</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="n">out_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Make a gif animation to preview it</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="o">=</span> <span class="s1">&#39;LST&#39;</span>
<span class="c1"># select our variable of interest</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>

<span class="c1"># create the gif animation</span>
<span class="n">gif_bytes</span> <span class="o">=</span> <span class="n">geogif</span><span class="o">.</span><span class="n">dgif</span><span class="p">(</span>
    <span class="n">da</span><span class="p">,</span>
    <span class="n">fps</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">date_format</span><span class="o">=</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span>
    <span class="n">date_position</span><span class="o">=</span><span class="s2">&quot;ul&quot;</span><span class="p">,</span>
    <span class="nb">bytes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="c1"># write gif to file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test6.gif&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">gif_bytes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Take a look at the gif image we just made:</p>
<p><img alt="GOES-18 animation" class="no-scaled-link" src="examples/test6.gif" style="width: 400px;" /></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../get_data.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">goes_ortho.get_data</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="download.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Download GOES</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Steven Pestana
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>