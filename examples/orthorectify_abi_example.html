<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>Orthorectify GOES-R RGB images - goes_ortho 0.2.1.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">goes_ortho 0.2.1.5 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">goes_ortho 0.2.1.5 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_start.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Download GOES</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_workflow.html">Example workflow</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_data.html">goes_ortho.get_data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orthorectify.html">goes_ortho.orthorectify</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timeseries.html">goes_ortho.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometry.html">goes_ortho.geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../clip.html">goes_ortho.clip</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rad.html">goes_ortho.rad</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="Orthorectify-GOES-R-RGB-images">
<h1>Orthorectify GOES-R RGB images<a class="headerlink" href="#Orthorectify-GOES-R-RGB-images" title="Permalink to this heading">#</a></h1>
<p>Orthorectify red, “green”, and blue bands of GOES ABI for a single set of observations from GOES-16 and GOES-17.</p>
<p>This notebook demonstrates the use of the <a class="reference external" href="https://github.com/spestana/goes-ortho/blob/master/examples/orthorectify_abi_example.ipynb">goes_ortho</a> functions, and RGB plotting is based on <a class="reference external" href="https://github.com/daniellelosos/True-Color-Image_GOES-R-ABI-L1b-Radiances">this notebook</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># for plotting geotiff rasters</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># import get_dem function from https://github.com/uw-cryo/asp-binder-demo/blob/6f03afadc7f4c6e13422da6d5f480c7f6762b47b/asp_binder_utils.py</span>
<span class="kn">from</span> <span class="nn">asp_binder_utils</span> <span class="kn">import</span> <span class="n">get_dem</span>

<span class="kn">import</span> <span class="nn">goes_ortho</span>
</pre></div>
</div>
</div>
<p>I am using <a class="reference external" href="https://github.com/uw-cryo/asp-binder-demo/blob/6f03afadc7f4c6e13422da6d5f480c7f6762b47b/asp_binder_utils.py">this</a> extremely handy function, <code class="docutils literal notranslate"><span class="pre">get_dem()</span></code> from the <a class="reference external" href="https://github.com/uw-cryo">UW Terrain Analysis and Cryosphere Observation Lab</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dem_filepath</span> <span class="o">=</span> <span class="s2">&quot;./dem/tuolumne_dem.tif&quot;</span>

<span class="n">get_dem</span><span class="p">(</span>
    <span class="n">demtype</span><span class="o">=</span><span class="s2">&quot;SRTMGL1_E&quot;</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">119.6</span><span class="p">,</span> <span class="mf">37.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">119.2</span><span class="p">,</span> <span class="mf">38.1</span><span class="p">),</span>
    <span class="n">out_fn</span><span class="o">=</span><span class="n">dem_filepath</span><span class="p">,</span>
    <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;./dem/tuolumne_dem.tif&#39;
</pre></div></div>
</div>
<hr class="docutils" />
<p>Use the <code class="docutils literal notranslate"><span class="pre">download-goes.py</span></code> script to download GOES ABI-L1b-RadC products for channels 1, 2, and 3, for both GOES-16 and GOES-17 on March 3rd, 2020.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python ./download-goes.py --bucket noaa-goes16 --year 2020 --month 3 --days 3 3  --product ABI-L1b-RadC --channel C01 --bounds 30 50 -125 -105 --dir /storage/GOES/</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python ./download-goes.py --bucket noaa-goes16 --year 2020 --month 3 --days 3 3  --product ABI-L1b-RadC --channel C02 --bounds 30 50 -125 -105 --dir /storage/GOES/</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python ./download-goes.py --bucket noaa-goes16 --year 2020 --month 3 --days 3 3  --product ABI-L1b-RadC --channel C03 --bounds 30 50 -125 -105 --dir /storage/GOES/</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python ./download-goes.py --bucket noaa-goes17 --year 2020 --month 3 --days 3 3  --product ABI-L1b-RadC --channel C01 --bounds 30 50 -125 -105 --dir /storage/GOES/</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python ./download-goes.py --bucket noaa-goes17 --year 2020 --month 3 --days 3 3  --product ABI-L1b-RadC --channel C02 --bounds 30 50 -125 -105 --dir /storage/GOES/</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="ch">#!python ./download-goes.py --bucket noaa-goes17 --year 2020 --month 3 --days 3 3  --product ABI-L1b-RadC --channel C03 --bounds 30 50 -125 -105 --dir /storage/GOES/</span>
</pre></div>
</div>
</div>
<p>Here I just have lists of the GOES-16 and -17 ABI channel 1, 2, and 3 images I’ll be orthorectifying, and then using to make RGB images.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOES-16</span>
<span class="n">goes16_images</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;/storage/GOES/goes16/2020/3/3/ABI-L1b-RadC/00/C01/OR_ABI-L1b-RadC-M6C01_G16_s20200630001139_e20200630003512_c20200630003557.nc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/storage/GOES/goes16/2020/3/3/ABI-L1b-RadC/00/C02/OR_ABI-L1b-RadC-M6C02_G16_s20200630001139_e20200630003512_c20200630003542.nc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/storage/GOES/goes16/2020/3/3/ABI-L1b-RadC/00/C03/OR_ABI-L1b-RadC-M6C03_G16_s20200630001139_e20200630003512_c20200630003571.nc&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># GOES-17</span>
<span class="n">goes17_images</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;/storage/GOES/goes17/2020/3/3/ABI-L1b-RadC/00/C01/OR_ABI-L1b-RadC-M6C01_G17_s20200630001176_e20200630003549_c20200630004011.nc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/storage/GOES/goes17/2020/3/3/ABI-L1b-RadC/00/C02/OR_ABI-L1b-RadC-M6C02_G17_s20200630001176_e20200630003549_c20200630003571.nc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;/storage/GOES/goes17/2020/3/3/ABI-L1b-RadC/00/C03/OR_ABI-L1b-RadC-M6C03_G17_s20200630001176_e20200630003549_c20200630004001.nc&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<p>For each of the three GOES-16 images, create an “ortho map” with <code class="docutils literal notranslate"><span class="pre">goes_ortho.make_ortho_map()</span></code> that describes how the original image in ABI scan angle units translates to latitude and longitude, given the parallax effect caused by local terrain. Then use this “ortho map” in <code class="docutils literal notranslate"><span class="pre">goes_ortho.orthorectify_abi()</span></code> to orthorectify the ABI image and output a new NetCDF file clipped to the bounds of the DEM we’re using.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">goes16_images</span><span class="p">:</span>
    <span class="c1"># create a new filename</span>
    <span class="n">new_filename</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_orthorectified.nc&quot;</span>

    <span class="c1"># create the mapping between scan angle coordinates and lat/lon given the GOES satellite position and our DEM</span>
    <span class="n">ortho_map</span> <span class="o">=</span> <span class="n">goes_ortho</span><span class="o">.</span><span class="n">make_ortho_map</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">dem_filepath</span><span class="p">)</span>

    <span class="c1"># specify which data variables from the original ABI product we want in our new orthorectified file</span>
    <span class="n">data_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Rad&quot;</span><span class="p">]</span>  <span class="c1"># I&#39;m only selecting the Radiance product.</span>

    <span class="c1"># Note, because we&#39;ve supplied Radiance to orthorectify_abi(), we will also get reflectance (for bands 1-6) or brightness temperature (for bands 7-16)</span>

    <span class="c1"># Apply the &quot;ortho map&quot; and save a new NetCDF file with data variables from the original file</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">goes_ortho</span><span class="o">.</span><span class="n">orthorectify_abi</span><span class="p">(</span>
        <span class="n">image_path</span><span class="p">,</span> <span class="n">ortho_map</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">,</span> <span class="n">out_filename</span><span class="o">=</span><span class="n">new_filename</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
&lt;xarray.Dataset&gt;
Dimensions:         (latitude: 2160, longitude: 3240)
Coordinates:
  * longitude       (longitude) float64 -119.8 -119.8 -119.8 ... -118.9 -118.9
  * latitude        (latitude) float64 38.1 38.1 38.1 38.1 ... 37.5 37.5 37.5
    dem_px_angle_x  (latitude, longitude) float64 -0.09106 -0.09106 ... -0.09056
    dem_px_angle_y  (latitude, longitude) float64 0.1011 0.1011 ... 0.09999
Data variables:
    elevation       (latitude, longitude) float32 2117.2366 ... 3168.3154
Attributes:
    longitude_of_projection_origin:       -75.0
    semi_major_axis:                      6378137.0
    semi_minor_axis:                      6356752.31414
    satellite_height:                     42164160.0
    grs80_eccentricity:                   0.0818191910435
    longitude_of_projection_origin_info:  longitude of geostationary satellit...
    semi_major_axis_info:                 semi-major axis of GRS 80 reference...
    semi_minor_axis_info:                 semi-minor axis of GRS 80 reference...
    satellite_height_info:                distance from center of ellipsoid t...
    grs80_eccentricity_info:              eccentricity of GRS 80 reference el...
    dem_file:                             ./dem/tuolumne_dem.tif
    dem_crs:                              +init=epsg:4326
    dem_transform:                        (0.00027777777777781464, 0.0, -119....
    dem_res:                              (0.00027777777777781464, 0.00027777...
    dem_ifov:                             -9999
    dem_file_info:                        filename of dem file used to create...
    dem_crs_info:                         coordinate reference system from DE...
    dem_transform_info:                   transform matrix from DEM geotiff
    dem_res_info:                         resolution of DEM geotiff
    dem_ifov_info:                        instantaneous field of view (angula...
    dem_px_angle_x_info:                  DEM grid cell X coordinate (east/we...
    dem_px_angle_y_info:                  DEM grid cell Y coordinate (north/s...
    longitude_info:                       longitude from DEM file
    latitude_info:                        latitude from DEM file
    elevation_info:                       elevation from DEM file
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -75.0           -75.0
...done

Map (orthorectify) and clip the image to the pixel map for Rad
...done

Output this result to a new NetCDF file
Saving file as: OR_ABI-L1b-RadC-M6C01_G16_s20200630001139_e20200630003512_c20200630003557_orthorectified.nc
...done

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
&lt;xarray.Dataset&gt;
Dimensions:         (latitude: 2160, longitude: 3240)
Coordinates:
  * longitude       (longitude) float64 -119.8 -119.8 -119.8 ... -118.9 -118.9
  * latitude        (latitude) float64 38.1 38.1 38.1 38.1 ... 37.5 37.5 37.5
    dem_px_angle_x  (latitude, longitude) float64 -0.09106 -0.09106 ... -0.09056
    dem_px_angle_y  (latitude, longitude) float64 0.1011 0.1011 ... 0.09999
Data variables:
    elevation       (latitude, longitude) float32 2117.2366 ... 3168.3154
Attributes:
    longitude_of_projection_origin:       -75.0
    semi_major_axis:                      6378137.0
    semi_minor_axis:                      6356752.31414
    satellite_height:                     42164160.0
    grs80_eccentricity:                   0.0818191910435
    longitude_of_projection_origin_info:  longitude of geostationary satellit...
    semi_major_axis_info:                 semi-major axis of GRS 80 reference...
    semi_minor_axis_info:                 semi-minor axis of GRS 80 reference...
    satellite_height_info:                distance from center of ellipsoid t...
    grs80_eccentricity_info:              eccentricity of GRS 80 reference el...
    dem_file:                             ./dem/tuolumne_dem.tif
    dem_crs:                              +init=epsg:4326
    dem_transform:                        (0.00027777777777781464, 0.0, -119....
    dem_res:                              (0.00027777777777781464, 0.00027777...
    dem_ifov:                             -9999
    dem_file_info:                        filename of dem file used to create...
    dem_crs_info:                         coordinate reference system from DE...
    dem_transform_info:                   transform matrix from DEM geotiff
    dem_res_info:                         resolution of DEM geotiff
    dem_ifov_info:                        instantaneous field of view (angula...
    dem_px_angle_x_info:                  DEM grid cell X coordinate (east/we...
    dem_px_angle_y_info:                  DEM grid cell Y coordinate (north/s...
    longitude_info:                       longitude from DEM file
    latitude_info:                        latitude from DEM file
    elevation_info:                       elevation from DEM file
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -75.0           -75.0
...done

Map (orthorectify) and clip the image to the pixel map for Rad
...done

Output this result to a new NetCDF file
Saving file as: OR_ABI-L1b-RadC-M6C02_G16_s20200630001139_e20200630003512_c20200630003542_orthorectified.nc
...done

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
&lt;xarray.Dataset&gt;
Dimensions:         (latitude: 2160, longitude: 3240)
Coordinates:
  * longitude       (longitude) float64 -119.8 -119.8 -119.8 ... -118.9 -118.9
  * latitude        (latitude) float64 38.1 38.1 38.1 38.1 ... 37.5 37.5 37.5
    dem_px_angle_x  (latitude, longitude) float64 -0.09106 -0.09106 ... -0.09056
    dem_px_angle_y  (latitude, longitude) float64 0.1011 0.1011 ... 0.09999
Data variables:
    elevation       (latitude, longitude) float32 2117.2366 ... 3168.3154
Attributes:
    longitude_of_projection_origin:       -75.0
    semi_major_axis:                      6378137.0
    semi_minor_axis:                      6356752.31414
    satellite_height:                     42164160.0
    grs80_eccentricity:                   0.0818191910435
    longitude_of_projection_origin_info:  longitude of geostationary satellit...
    semi_major_axis_info:                 semi-major axis of GRS 80 reference...
    semi_minor_axis_info:                 semi-minor axis of GRS 80 reference...
    satellite_height_info:                distance from center of ellipsoid t...
    grs80_eccentricity_info:              eccentricity of GRS 80 reference el...
    dem_file:                             ./dem/tuolumne_dem.tif
    dem_crs:                              +init=epsg:4326
    dem_transform:                        (0.00027777777777781464, 0.0, -119....
    dem_res:                              (0.00027777777777781464, 0.00027777...
    dem_ifov:                             -9999
    dem_file_info:                        filename of dem file used to create...
    dem_crs_info:                         coordinate reference system from DE...
    dem_transform_info:                   transform matrix from DEM geotiff
    dem_res_info:                         resolution of DEM geotiff
    dem_ifov_info:                        instantaneous field of view (angula...
    dem_px_angle_x_info:                  DEM grid cell X coordinate (east/we...
    dem_px_angle_y_info:                  DEM grid cell Y coordinate (north/s...
    longitude_info:                       longitude from DEM file
    latitude_info:                        latitude from DEM file
    elevation_info:                       elevation from DEM file
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -75.0           -75.0
...done

Map (orthorectify) and clip the image to the pixel map for Rad
...done

Output this result to a new NetCDF file
Saving file as: OR_ABI-L1b-RadC-M6C03_G16_s20200630001139_e20200630003512_c20200630003571_orthorectified.nc
...done
</pre></div></div>
</div>
<p>Plot an imaginary pixel footprint to see the poitn of view of the GOES ABI and in map view.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_y&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># plot a single demo pixel footprint</span>
<span class="n">ifov</span> <span class="o">=</span> <span class="mf">0.000028</span>  <span class="c1"># radians</span>
<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">0.09075</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.09075</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&gt;=</span> <span class="mf">0.1007</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&lt;=</span> <span class="mf">0.1007</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_y&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;spring_r&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;a) DEM in GOES-16 View (ABI fixed grid)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elevation Angle (radians)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Scan Angle (radians)&quot;</span><span class="p">)</span>


<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># plot the same single demo pixel footprint</span>
<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">0.09075</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.09075</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&gt;=</span> <span class="mf">0.1007</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&lt;=</span> <span class="mf">0.1007</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;spring_r&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;b) DEM in Map View (WGS 84)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude (degrees)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degrees)&quot;</span><span class="p">)</span>

<span class="n">ortho_map</span><span class="o">.</span><span class="n">Rad</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_y&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Band 2 (red) Radiance ($W m^{-2} sr^{-1} \mu m^{-1}$)&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;c) GOES-16 ABI (ABI fixed grid)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elevation Angle (radians)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Scan Angle (radians)&quot;</span><span class="p">)</span>


<span class="n">ortho_map</span><span class="o">.</span><span class="n">Rad</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Band 2 (red) Radiance ($W m^{-2} sr^{-1} \mu m^{-1}$)&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;d) Orthorectified GOES-16 ABI (WGS 84)&quot;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude (degrees)&quot;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degrees)&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_orthorectify_abi_example_17_0.png" src="../_images/examples_orthorectify_abi_example_17_0.png" />
</div>
</div>
<p>Now do the same for the three GOES-17 images.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">image_path</span> <span class="ow">in</span> <span class="n">goes17_images</span><span class="p">:</span>
    <span class="c1"># create a new filename</span>
    <span class="n">new_filename</span> <span class="o">=</span> <span class="n">image_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_orthorectified.nc&quot;</span>

    <span class="c1"># create the mapping between scan angle coordinates and lat/lon given the GOES satellite position and our DEM</span>
    <span class="n">ortho_map</span> <span class="o">=</span> <span class="n">goes_ortho</span><span class="o">.</span><span class="n">make_ortho_map</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">dem_filepath</span><span class="p">)</span>

    <span class="c1"># specify which data variables from the original ABI product we want in our new orthorectified file</span>
    <span class="n">data_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Rad&quot;</span><span class="p">]</span>  <span class="c1"># I&#39;m only selecting the Radiance product.</span>

    <span class="c1"># Note, because we&#39;ve supplied Radiance to orthorectify_abi(), we will also get reflectance (for bands 1-6) or brightness temperature (for bands 7-16)</span>

    <span class="c1"># Apply the &quot;ortho map&quot; and save a new NetCDF file with data variables from the original file</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">goes_ortho</span><span class="o">.</span><span class="n">orthorectify_abi</span><span class="p">(</span>
        <span class="n">image_path</span><span class="p">,</span> <span class="n">ortho_map</span><span class="p">,</span> <span class="n">data_vars</span><span class="p">,</span> <span class="n">out_filename</span><span class="o">=</span><span class="n">new_filename</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
&lt;xarray.Dataset&gt;
Dimensions:         (latitude: 2160, longitude: 3240)
Coordinates:
  * longitude       (longitude) float64 -119.8 -119.8 -119.8 ... -118.9 -118.9
  * latitude        (latitude) float64 38.1 38.1 38.1 38.1 ... 37.5 37.5 37.5
    dem_px_angle_x  (latitude, longitude) float64 0.03955 0.03955 ... 0.04192
    dem_px_angle_y  (latitude, longitude) float64 0.1044 0.1044 ... 0.1031
Data variables:
    elevation       (latitude, longitude) float32 2117.2366 ... 3168.3154
Attributes:
    longitude_of_projection_origin:       -137.0
    semi_major_axis:                      6378137.0
    semi_minor_axis:                      6356752.31414
    satellite_height:                     42164160.0
    grs80_eccentricity:                   0.0818191910435
    longitude_of_projection_origin_info:  longitude of geostationary satellit...
    semi_major_axis_info:                 semi-major axis of GRS 80 reference...
    semi_minor_axis_info:                 semi-minor axis of GRS 80 reference...
    satellite_height_info:                distance from center of ellipsoid t...
    grs80_eccentricity_info:              eccentricity of GRS 80 reference el...
    dem_file:                             ./dem/tuolumne_dem.tif
    dem_crs:                              +init=epsg:4326
    dem_transform:                        (0.00027777777777781464, 0.0, -119....
    dem_res:                              (0.00027777777777781464, 0.00027777...
    dem_ifov:                             -9999
    dem_file_info:                        filename of dem file used to create...
    dem_crs_info:                         coordinate reference system from DE...
    dem_transform_info:                   transform matrix from DEM geotiff
    dem_res_info:                         resolution of DEM geotiff
    dem_ifov_info:                        instantaneous field of view (angula...
    dem_px_angle_x_info:                  DEM grid cell X coordinate (east/we...
    dem_px_angle_y_info:                  DEM grid cell Y coordinate (north/s...
    longitude_info:                       longitude from DEM file
    latitude_info:                        latitude from DEM file
    elevation_info:                       elevation from DEM file
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -137.0          -137.0
...done

Map (orthorectify) and clip the image to the pixel map for Rad
...done

Output this result to a new NetCDF file
Saving file as: OR_ABI-L1b-RadC-M6C01_G17_s20200630001176_e20200630003549_c20200630004011_orthorectified.nc
...done

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
&lt;xarray.Dataset&gt;
Dimensions:         (latitude: 2160, longitude: 3240)
Coordinates:
  * longitude       (longitude) float64 -119.8 -119.8 -119.8 ... -118.9 -118.9
  * latitude        (latitude) float64 38.1 38.1 38.1 38.1 ... 37.5 37.5 37.5
    dem_px_angle_x  (latitude, longitude) float64 0.03955 0.03955 ... 0.04192
    dem_px_angle_y  (latitude, longitude) float64 0.1044 0.1044 ... 0.1031
Data variables:
    elevation       (latitude, longitude) float32 2117.2366 ... 3168.3154
Attributes:
    longitude_of_projection_origin:       -137.0
    semi_major_axis:                      6378137.0
    semi_minor_axis:                      6356752.31414
    satellite_height:                     42164160.0
    grs80_eccentricity:                   0.0818191910435
    longitude_of_projection_origin_info:  longitude of geostationary satellit...
    semi_major_axis_info:                 semi-major axis of GRS 80 reference...
    semi_minor_axis_info:                 semi-minor axis of GRS 80 reference...
    satellite_height_info:                distance from center of ellipsoid t...
    grs80_eccentricity_info:              eccentricity of GRS 80 reference el...
    dem_file:                             ./dem/tuolumne_dem.tif
    dem_crs:                              +init=epsg:4326
    dem_transform:                        (0.00027777777777781464, 0.0, -119....
    dem_res:                              (0.00027777777777781464, 0.00027777...
    dem_ifov:                             -9999
    dem_file_info:                        filename of dem file used to create...
    dem_crs_info:                         coordinate reference system from DE...
    dem_transform_info:                   transform matrix from DEM geotiff
    dem_res_info:                         resolution of DEM geotiff
    dem_ifov_info:                        instantaneous field of view (angula...
    dem_px_angle_x_info:                  DEM grid cell X coordinate (east/we...
    dem_px_angle_y_info:                  DEM grid cell Y coordinate (north/s...
    longitude_info:                       longitude from DEM file
    latitude_info:                        latitude from DEM file
    elevation_info:                       elevation from DEM file
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -137.0          -137.0
...done

Map (orthorectify) and clip the image to the pixel map for Rad
...done

Output this result to a new NetCDF file
Saving file as: OR_ABI-L1b-RadC-M6C02_G17_s20200630001176_e20200630003549_c20200630003571_orthorectified.nc
...done

RUNNING: make_ortho_map()

Opening GOES ABI image...

Get inputs: projection information from the ABI radiance product
...done

Opening DEM file...

Create 2D arrays of longitude and latitude from the DEM
...done

For each grid cell in the DEM, compute the corresponding ABI scan angle (x and y, radians)
...done

Create metadata dictionary about this map
...done

Create pixel map dataset
&lt;xarray.Dataset&gt;
Dimensions:         (latitude: 2160, longitude: 3240)
Coordinates:
  * longitude       (longitude) float64 -119.8 -119.8 -119.8 ... -118.9 -118.9
  * latitude        (latitude) float64 38.1 38.1 38.1 38.1 ... 37.5 37.5 37.5
    dem_px_angle_x  (latitude, longitude) float64 0.03955 0.03955 ... 0.04192
    dem_px_angle_y  (latitude, longitude) float64 0.1044 0.1044 ... 0.1031
Data variables:
    elevation       (latitude, longitude) float32 2117.2366 ... 3168.3154
Attributes:
    longitude_of_projection_origin:       -137.0
    semi_major_axis:                      6378137.0
    semi_minor_axis:                      6356752.31414
    satellite_height:                     42164160.0
    grs80_eccentricity:                   0.0818191910435
    longitude_of_projection_origin_info:  longitude of geostationary satellit...
    semi_major_axis_info:                 semi-major axis of GRS 80 reference...
    semi_minor_axis_info:                 semi-minor axis of GRS 80 reference...
    satellite_height_info:                distance from center of ellipsoid t...
    grs80_eccentricity_info:              eccentricity of GRS 80 reference el...
    dem_file:                             ./dem/tuolumne_dem.tif
    dem_crs:                              +init=epsg:4326
    dem_transform:                        (0.00027777777777781464, 0.0, -119....
    dem_res:                              (0.00027777777777781464, 0.00027777...
    dem_ifov:                             -9999
    dem_file_info:                        filename of dem file used to create...
    dem_crs_info:                         coordinate reference system from DE...
    dem_transform_info:                   transform matrix from DEM geotiff
    dem_res_info:                         resolution of DEM geotiff
    dem_ifov_info:                        instantaneous field of view (angula...
    dem_px_angle_x_info:                  DEM grid cell X coordinate (east/we...
    dem_px_angle_y_info:                  DEM grid cell Y coordinate (north/s...
    longitude_info:                       longitude from DEM file
    latitude_info:                        latitude from DEM file
    elevation_info:                       elevation from DEM file
...done

Return the pixel map dataset.

RUNNING: orthorectify_abi_rad()

Does the projection info in the image match our mapping?

Opening GOES ABI image...                       ABI image value Pixel map value
perspective_point_height + semi_major_axis:     42164160.0      42164160.0
semi_major_axis:                                6378137.0       6378137.0
semi_minor_axis:                                6356752.31414   6356752.31414
longitude_of_projection_origin:                 -137.0          -137.0
...done

Map (orthorectify) and clip the image to the pixel map for Rad
...done

Output this result to a new NetCDF file
Saving file as: OR_ABI-L1b-RadC-M6C03_G17_s20200630001176_e20200630003549_c20200630004001_orthorectified.nc
...done
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_y&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">},</span>
<span class="p">)</span>

<span class="c1"># plot a single demo pixel footprint</span>
<span class="n">ifov</span> <span class="o">=</span> <span class="mf">0.000028</span>  <span class="c1"># radians</span>
<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&gt;=</span> <span class="mf">0.0407</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&lt;=</span> <span class="mf">0.0407</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&gt;=</span> <span class="mf">0.10395</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&lt;=</span> <span class="mf">0.10395</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_y&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;spring_r&quot;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;a) DEM in GOES-17 View (ABI fixed grid)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elevation Angle (radians)&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Scan Angle (radians)&quot;</span><span class="p">)</span>


<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;terrain&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># plot the same single demo pixel footprint</span>
<span class="n">ortho_map</span><span class="o">.</span><span class="n">elevation</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&gt;=</span> <span class="mf">0.0407</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_x</span> <span class="o">&lt;=</span> <span class="mf">0.0407</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&gt;=</span> <span class="mf">0.10395</span> <span class="o">-</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">ortho_map</span><span class="o">.</span><span class="n">dem_px_angle_y</span> <span class="o">&lt;=</span> <span class="mf">0.10395</span> <span class="o">+</span> <span class="p">(</span><span class="n">ifov</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;spring_r&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">100</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;b) DEM in Map View (WGS 84)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude (degrees)&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degrees)&quot;</span><span class="p">)</span>

<span class="n">ortho_map</span><span class="o">.</span><span class="n">Rad</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_x&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;dem_px_angle_y&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Band 2 (red) Radiance ($W m^{-2} sr^{-1} \mu m^{-1}$)&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;c) GOES-17 ABI (ABI fixed grid)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Elevation Angle (radians)&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Scan Angle (radians)&quot;</span><span class="p">)</span>


<span class="n">ortho_map</span><span class="o">.</span><span class="n">Rad</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys_r&quot;</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Band 2 (red) Radiance ($W m^{-2} sr^{-1} \mu m^{-1}$)&quot;</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;d) Orthorectified GOES-17 ABI (WGS 84)&quot;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude (degrees)&quot;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude (degrees)&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_orthorectify_abi_example_20_0.png" src="../_images/examples_orthorectify_abi_example_20_0.png" />
</div>
</div>
<hr class="docutils" />
<p>The function below for creating RGB images from GOES-R ABI reflectance is based on <a class="reference external" href="Adapted%20from%20https://github.com/daniellelosos/True-Color-Image_GOES-R-ABI-L1b-Radiances">this notebook</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">makeABIrgb_fromReflectance</span><span class="p">(</span><span class="n">R_ref</span><span class="p">,</span> <span class="n">G_ref</span><span class="p">,</span> <span class="n">B_ref</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create RGB images given GOES-R ABI Channel 01, 02, and 03 datasets.</span>
<span class="sd">    Adapted from https://github.com/daniellelosos/True-Color-Image_GOES-R-ABI-L1b-Radiances</span>

<span class="sd">    returns:</span>
<span class="sd">            RGB: &quot;True Color&quot; RGB</span>
<span class="sd">            RGB_veggie: &quot;False Color&quot; RGB</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Apply range limits for each channel. Reflectance values must be between 0 and 1.</span>
    <span class="n">R_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">R_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">G_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">G_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">B_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">B_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Apply a gamma correction to the image to correct ABI detector brightness</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="mf">2.2</span>
    <span class="n">Red</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">R_ref</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">Green</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">G_ref</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="n">Blue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">B_ref</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">gamma</span><span class="p">)</span>

    <span class="c1"># GOES-R Series satellites do not have a channel in the visible green range. Band 3 is a NIR channel typically used to monitor vegetation.</span>
    <span class="c1"># Calculate the &quot;True&quot; Green Band to serve as a green proxy for the RGB True Color image, using a fractional combination.</span>
    <span class="c1"># Source: &quot;Generation of GOES‐16 True Color Imagery without a Green Band&quot; - https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018EA000379</span>
    <span class="n">Green_true</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="n">Red</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Green</span> <span class="o">+</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="n">Blue</span>
    <span class="n">Green_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">Green_true</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Apply band limits again, just in case.</span>

    <span class="c1"># Combine three RGB channels with a stacked array, then display the resulting images.</span>

    <span class="c1"># The RGB array with the raw veggie band</span>
    <span class="n">RGB_veggie</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">Red</span><span class="p">,</span> <span class="n">Green</span><span class="p">,</span> <span class="n">Blue</span><span class="p">])</span>

    <span class="c1"># The RGB array for the true color image</span>
    <span class="n">RGB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">Red</span><span class="p">,</span> <span class="n">Green_true</span><span class="p">,</span> <span class="n">Blue</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">RGB</span><span class="p">,</span> <span class="n">RGB_veggie</span>
</pre></div>
</div>
</div>
<p>Open our six new orthorectified datasets:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOES-16</span>
<span class="n">goes_16_C01</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;OR_ABI-L1b-RadC-M6C01_G16_s20200630001139_e20200630003512_c20200630003557_orthorectified.nc&quot;</span>
<span class="p">)</span>
<span class="n">goes_16_C02</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;OR_ABI-L1b-RadC-M6C02_G16_s20200630001139_e20200630003512_c20200630003542_orthorectified.nc&quot;</span>
<span class="p">)</span>
<span class="n">goes_16_C03</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;OR_ABI-L1b-RadC-M6C03_G16_s20200630001139_e20200630003512_c20200630003571_orthorectified.nc&quot;</span>
<span class="p">)</span>

<span class="c1"># GOES-17</span>
<span class="n">goes_17_C01</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;OR_ABI-L1b-RadC-M6C01_G17_s20200630001176_e20200630003549_c20200630004011_orthorectified.nc&quot;</span>
<span class="p">)</span>
<span class="n">goes_17_C02</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;OR_ABI-L1b-RadC-M6C02_G17_s20200630001176_e20200630003549_c20200630003571_orthorectified.nc&quot;</span>
<span class="p">)</span>
<span class="n">goes_17_C03</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
    <span class="s2">&quot;OR_ABI-L1b-RadC-M6C03_G17_s20200630001176_e20200630003549_c20200630004001_orthorectified.nc&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">goes16_RGB</span><span class="p">,</span> <span class="n">goes16_RGB_veggie</span> <span class="o">=</span> <span class="n">makeABIrgb_fromReflectance</span><span class="p">(</span>
    <span class="n">goes_16_C02</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">goes_16_C03</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">goes_16_C01</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">data</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">goes17_RGB</span><span class="p">,</span> <span class="n">goes17_RGB_veggie</span> <span class="o">=</span> <span class="n">makeABIrgb_fromReflectance</span><span class="p">(</span>
    <span class="n">goes_17_C02</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">goes_17_C03</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">goes_17_C01</span><span class="o">.</span><span class="n">ref</span><span class="o">.</span><span class="n">data</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Plot the GOES-16 and -7 RGB images that have been orthorectified:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up plot figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">tight_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># GOES-17 False Color: RGB using the NIR &quot;Veggie&quot; Band</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">goes17_RGB_veggie</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;GOES-17 &quot;False Color&quot; RGB&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1"># GOES-16 False Color: RGB using the NIR &quot;Veggie&quot; Band</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">goes16_RGB_veggie</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;GOES-16 &quot;False Color&quot; RGB&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1"># GOES-17 True Color: RGB for the true color image</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">goes17_RGB</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;GOES-17 &quot;True Color&quot; RGB&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>

<span class="c1"># GOES-16 True Color: RGB for the true color image</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">goes16_RGB</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;GOES-16 &quot;True Color&quot; RGB&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_orthorectify_abi_example_28_0.png" src="../_images/examples_orthorectify_abi_example_28_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Steven Pestana
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>